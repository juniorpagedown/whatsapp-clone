# ğŸ“Š Diagrama ER Atualizado - WhatsApp Clone IA + Sistema de SLA

## ğŸ¨ Diagrama Completo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        WHATSAPP CLONE IA - DATABASE SCHEMA                              â”‚
â”‚                     Com Sistema de ClassificaÃ§Ã£o e SLA                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USUARIOS      â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â€¢ id PK         â”‚
â”‚ â€¢ email  UNIQUE â”‚
â”‚ â€¢ password_hash â”‚
â”‚ â€¢ nome          â”‚
â”‚ â€¢ role          â”‚
â”‚ â€¢ is_active     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ responsÃ¡vel_por
        â”‚
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           BLOCO COMUNICAÃ‡ÃƒO (WhatsApp Core)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   CONTATOS   â”‚                  â”‚    GRUPOS    â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚ â€¢ id PK      â”‚                  â”‚ â€¢ id PK      â”‚
     â”‚ â€¢ phone UQ   â”‚                  â”‚ â€¢ group_id UQâ”‚
     â”‚ â€¢ nome       â”‚                  â”‚ â€¢ nome       â”‚â—„â”€â”€â”€â”€â”
     â”‚ â€¢ avatar     â”‚                  â”‚ â€¢ descricao  â”‚     â”‚
     â”‚ â€¢ metadata   â”‚                  â”‚ â€¢ avatar     â”‚     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â”‚
             â”‚                                 â”‚            â”‚
             â”‚ 1                               â”‚ 1          â”‚
             â”‚                                 â”‚            â”‚
             â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
             â”‚            â”‚ N                               â”‚
             â”‚            â†“                                 â”‚
             â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
             â”‚    â”‚GRUPO_PARTICIPANTESâ”‚                    â”‚
             â””â”€â”€â”€â†’â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚
              N   â”‚ â€¢ id PK           â”‚                    â”‚
                  â”‚ â€¢ grupo_id    FK  â”‚                    â”‚
                  â”‚ â€¢ contato_id  FK  â”‚                    â”‚
                  â”‚ â€¢ is_admin        â”‚                    â”‚
                  â”‚ â€¢ joined_at       â”‚                    â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
                            â”‚                              â”‚
                            â”‚                              â”‚
                            â”‚                              â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
          â”‚                                        â”‚       â”‚
          â”‚ 1:N                                1:N â”‚       â”‚
          â†“                                        â†“       â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚   CONVERSAS   â”‚                    â”‚   CONVERSAS   â”‚  â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
  â”‚ â€¢ id PK       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ (grupo)       â”‚  â”‚
  â”‚ â€¢ chat_id UQ  â”‚         1          â”‚ â€¢ grupo_id FK â”‚  â”‚
  â”‚ â€¢ tipo        â”‚â—„â”€â”€â”€â”               â”‚ â€¢ metadata    â”‚  â”‚
  â”‚ â€¢ contato_id  â”‚    â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚ â€¢ grupo_id    â”‚    â”‚                                  â”‚
  â”‚ â€¢ metadata    â”‚    â”‚                                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ 1:N                              â”‚
          â”‚            â”‚                                  â”‚
          â”‚ 1          â”‚                                  â”‚
          â”‚            â”‚                                  â”‚
          â†“            â”‚                                  â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                                  â”‚
  â”‚   MENSAGENS   â”‚    â”‚                                  â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚    â”‚                                  â”‚
  â”‚ â€¢ id PK       â”‚    â”‚                                  â”‚
  â”‚ â€¢ message_id  â”‚    â”‚                                  â”‚
  â”‚ â€¢ conversa_id â”‚â”€â”€â”€â”€â”˜                                  â”‚
  â”‚ â€¢ contato_id  â”‚                                       â”‚
  â”‚ â€¢ texto       â”‚                                       â”‚
  â”‚ â€¢ media_url   â”‚                                       â”‚
  â”‚ â€¢ is_from_me  â”‚                                       â”‚
  â”‚ â€¢ embedding   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”
  â”‚ â€¢ sentiment   â”‚                                       â”‚    â”‚
  â”‚ â€¢ intent      â”‚                                       â”‚    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚    â”‚
          â”‚                                               â”‚    â”‚
          â”‚ 1                                             â”‚    â”‚
          â”‚                                               â”‚    â”‚
          â†“                                               â”‚    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚    â”‚
â”‚ IA_INTERACOES  â”‚                                        â”‚    â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                        â”‚    â”‚
â”‚ â€¢ id PK        â”‚                                        â”‚    â”‚
â”‚ â€¢ mensagem_id  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚ â€¢ conversa_id  â”‚                                             â”‚
â”‚ â€¢ prompt       â”‚                                             â”‚
â”‚ â€¢ resposta_ia  â”‚                                             â”‚
â”‚ â€¢ modelo       â”‚                                             â”‚
â”‚ â€¢ tokens       â”‚                                             â”‚
â”‚ â€¢ confidence   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚     â”‚
                                                               â”‚     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                     BLOCO IA E CONHECIMENTO                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CONHECIMENTO_BASE  â”‚         â”‚ IA_TREINAMENTO  â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â€¢ id PK            â”‚         â”‚ â€¢ id PK         â”‚
â”‚ â€¢ titulo           â”‚         â”‚ â€¢ pergunta      â”‚
â”‚ â€¢ conteudo         â”‚         â”‚ â€¢ resposta      â”‚
â”‚ â€¢ categoria        â”‚         â”‚ â€¢ categoria     â”‚
â”‚ â€¢ embedding        â”‚         â”‚ â€¢ embedding     â”‚
â”‚ â€¢ tags             â”‚         â”‚ â€¢ is_aprovado   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CONVERSA_CONTEXTO   â”‚        â”‚    IA_METRICAS     â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â€¢ id PK             â”‚        â”‚ â€¢ id PK            â”‚
â”‚ â€¢ conversa_id   FK  â”‚        â”‚ â€¢ data UNIQUE      â”‚
â”‚ â€¢ periodo_inicio    â”‚        â”‚ â€¢ total_interacoes â”‚
â”‚ â€¢ periodo_fim       â”‚        â”‚ â€¢ tempo_resposta   â”‚
â”‚ â€¢ resumo            â”‚        â”‚ â€¢ taxa_sucesso     â”‚
â”‚ â€¢ temas_principais  â”‚        â”‚ â€¢ custo_estimado   â”‚
â”‚ â€¢ embedding         â”‚        â”‚ â€¢ topicos_freq     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   âœ¨ NOVO: SISTEMA DE CLASSIFICAÃ‡ÃƒO E SLA âœ¨                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ MACRO_CATEGORIAS  â”‚
              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
              â”‚ â€¢ id PK           â”‚
              â”‚ â€¢ nome UNIQUE     â”‚
              â”‚ â€¢ descricao       â”‚
              â”‚ â€¢ icone           â”‚
              â”‚ â€¢ cor             â”‚
              â”‚ â€¢ ordem           â”‚
              â”‚ â€¢ is_active       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â”‚ 1
                      â”‚
                      â”‚ N
                      â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  SUBCATEGORIAS    â”‚
              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
              â”‚ â€¢ id PK           â”‚
              â”‚ â€¢ macro_cat_id FK â”‚â”€â”€â”
              â”‚ â€¢ nome            â”‚  â”‚
              â”‚ â€¢ sla_horas       â”‚  â”‚ ConfiguraÃ§Ã£o
              â”‚ â€¢ sla_hrs_criticasâ”‚  â”‚ de SLA
              â”‚ â€¢ keywords[]      â”‚  â”‚
              â”‚ â€¢ is_active       â”‚  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                      â”‚              â”‚
                      â”‚ 1            â”‚
                      â”‚              â”‚
                      â”‚ N            â”‚
                      â†“              â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
       â”‚     SOLICITACOES         â”‚ â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚
       â”‚ â€¢ id PK                  â”‚ â”‚
       â”‚ â€¢ conversa_id        FK  â”‚â”€â”¼â”€â”€â”€â”€â†’ CONVERSAS
       â”‚ â€¢ mensagem_origem_id FK  â”‚â”€â”¼â”€â”€â”€â”€â†’ MENSAGENS
       â”‚ â€¢ contato_id         FK  â”‚â”€â”¼â”€â”€â”€â”€â†’ CONTATOS
       â”‚ â€¢ responsavel_id     FK  â”‚â”€â”¼â”€â”€â”€â”€â†’ USUARIOS
       â”‚ â€¢ macro_categoria_id FK  â”‚â”€â”˜
       â”‚ â€¢ subcategoria_id    FK  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                          â”‚
       â”‚ â€¢ titulo                 â”‚
       â”‚ â€¢ descricao              â”‚
       â”‚ â€¢ prioridade             â”‚ â—„â”€ baixa, normal, alta, critica
       â”‚ â€¢ status                 â”‚ â—„â”€ aberta, em_andamento, aguardando_cliente,
       â”‚                          â”‚    resolvida, fechada, cancelada
       â”‚ â”€â”€â”€â”€â”€ SLA â”€â”€â”€â”€â”€          â”‚
       â”‚ â€¢ sla_due_at         â˜…   â”‚ â—„â”€ Calculado automaticamente
       â”‚ â€¢ sla_status         â˜…   â”‚ â—„â”€ dentro_prazo, proximo_vencimento, vencido
       â”‚ â€¢ sla_pausado_ate        â”‚
       â”‚ â€¢ tempo_pausa_total      â”‚
       â”‚                          â”‚
       â”‚ â”€â”€â”€â”€â”€ IA â”€â”€â”€â”€â”€           â”‚
       â”‚ â€¢ classificacao_auto â˜…   â”‚
       â”‚ â€¢ confidence_score   â˜…   â”‚ â—„â”€ 0.0000 a 1.0000
       â”‚                          â”‚
       â”‚ â”€â”€â”€â”€â”€ ResoluÃ§Ã£o â”€â”€â”€â”€â”€    â”‚
       â”‚ â€¢ resolvido_em           â”‚
       â”‚ â€¢ resolvido_por_id   FK  â”‚
       â”‚ â€¢ tempo_resolucao_minâ˜…   â”‚ â—„â”€ Calculado automaticamente
       â”‚ â€¢ solucao                â”‚
       â”‚ â€¢ avaliacao_cliente      â”‚ â—„â”€ 1 a 5 estrelas
       â”‚                          â”‚
       â”‚ â€¢ tags[]                 â”‚
       â”‚ â€¢ metadata JSONB         â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ 1
                â”‚
                â”‚ N
                â†“
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ HISTORICO_SOLICITACOES â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚ â€¢ id PK                â”‚
       â”‚ â€¢ solicitacao_id   FK  â”‚
       â”‚ â€¢ usuario_id       FK  â”‚
       â”‚ â€¢ acao                 â”‚ â—„â”€ criada, atribuida, status_alterado, etc
       â”‚ â€¢ status_anterior      â”‚
       â”‚ â€¢ status_novo          â”‚
       â”‚ â€¢ campo_alterado       â”‚
       â”‚ â€¢ valor_anterior       â”‚
       â”‚ â€¢ valor_novo           â”‚
       â”‚ â€¢ observacao           â”‚
       â”‚ â€¢ metadata JSONB       â”‚
       â”‚ â€¢ created_at           â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                      VIEWS                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ vw_solicitacoes_completas     â”‚        â”‚   vw_sla_em_risco        â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â€¢ todas as infos consolidadas â”‚        â”‚ â€¢ status IN (aberta,     â”‚
â”‚ â€¢ JOINs com todas as tabelas  â”‚        â”‚   em_andamento)          â”‚
â”‚ â€¢ formataÃ§Ã£o amigÃ¡vel         â”‚        â”‚ â€¢ sla_status = vencido   â”‚
â”‚ â€¢ cÃ¡lculos de SLA             â”‚        â”‚   ou proximo_vencimento  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â€¢ ordem por sla_due_at   â”‚
                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            TRIGGERS AUTOMÃTICOS â˜…                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. calculate_sla_due_at()         â†’ Calcula sla_due_at no INSERT
2. update_sla_status()            â†’ Atualiza sla_status (vencido/prÃ³ximo/dentro)
3. calculate_resolution_time()    â†’ Calcula tempo_resolucao_minutos
4. log_solicitacao_changes()      â†’ Registra em historico_solicitacoes
5. update_updated_at_column()     â†’ Atualiza updated_at

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ÃNDICES DE PERFORMANCE                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SOLICITACOES:
  â€¢ idx_sol_conversa_id           â†’ (conversa_id)
  â€¢ idx_sol_status_sla            â†’ (status, sla_status, sla_due_at)
  â€¢ idx_sol_responsavel_status    â†’ (usuario_responsavel_id, status) WHERE NOT NULL
  â€¢ idx_sol_sla_vencendo          â†’ (sla_due_at) WHERE status IN (...)
  â€¢ idx_sol_titulo_trgm           â†’ GIN(titulo) - busca de texto
  â€¢ idx_sol_tags                  â†’ GIN(tags)
  â€¢ idx_sol_metadata              â†’ GIN(metadata)

SUBCATEGORIAS:
  â€¢ idx_subcat_macro_id           â†’ (macro_categoria_id)
  â€¢ idx_subcat_keywords           â†’ GIN(keywords)

HISTORICO:
  â€¢ idx_hist_sol_id_created       â†’ (solicitacao_id, created_at DESC)
  â€¢ idx_hist_acao                 â†’ (acao)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         RELACIONAMENTOS PRINCIPAIS                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CONVERSAS  â”€â”€â”¬â”€â”€â†’  SOLICITACOES  (1:N)  â†’ Uma conversa pode ter vÃ¡rias solicitaÃ§Ãµes
             â”‚
MENSAGENS  â”€â”€â”´â”€â”€â†’  SOLICITACOES  (1:1)  â†’ Mensagem que originou a solicitaÃ§Ã£o

MACRO_CATEGORIAS  â”€â”€â†’  SUBCATEGORIAS  (1:N)  â†’ Hierarquia de categorias

SUBCATEGORIAS  â”€â”€â†’  SOLICITACOES  (1:N)  â†’ ClassificaÃ§Ã£o com SLA

USUARIOS  â”€â”€â†’  SOLICITACOES  (1:N)  â†’ ResponsÃ¡vel pela solicitaÃ§Ã£o

SOLICITACOES  â”€â”€â†’  HISTORICO_SOLICITACOES  (1:N)  â†’ Auditoria completa

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ESTATÃSTICAS DO SCHEMA                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total de Tabelas:        15  (11 originais + 4 novas)
Total de Views:          2   (vw_solicitacoes_completas, vw_sla_em_risco)
Total de Triggers:       8+  (5 principais + 3 update_updated_at)
Total de Functions:      5   (para triggers)
Total de Ãndices:        40+ (otimizaÃ§Ã£o de performance)

ExtensÃµes PostgreSQL:
  â€¢ pg_trgm              â†’ Busca de texto fuzzy
  â€¢ pgvector             â†’ Embeddings vetoriais (jÃ¡ existia)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              FLUXO DE UMA SOLICITAÃ‡ÃƒO                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. MENSAGEM chega â†’ CONVERSA â†’ CONTATO

2. IA CLASSIFICA:
   â€¢ Analisa texto
   â€¢ Match com keywords das SUBCATEGORIAS
   â€¢ Retorna confidence_score

3. SOLICITACAO criada:
   â€¢ INSERT com subcategoria_id
   â€¢ TRIGGER calcula sla_due_at automaticamente
   â€¢ TRIGGER atualiza sla_status
   â€¢ TRIGGER registra em HISTORICO

4. ATENDIMENTO:
   â€¢ Status muda: aberta â†’ em_andamento
   â€¢ TRIGGER registra mudanÃ§a
   â€¢ AtribuÃ­da a USUARIO

5. Se "aguardando_cliente":
   â€¢ sla_pausado_ate definido
   â€¢ tempo_pausa_total acumulado

6. RESOLUÃ‡ÃƒO:
   â€¢ Status â†’ resolvida
   â€¢ TRIGGER calcula tempo_resolucao_minutos
   â€¢ resolvido_em e resolvido_por_id preenchidos

7. AVALIAÃ‡ÃƒO:
   â€¢ Cliente dÃ¡ nota (1-5)
   â€¢ feedback_cliente opcional

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                  NOMENCLATURA                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Tabelas:                   snake_case (plural)
Colunas:                   snake_case
Primary Keys:              id
Foreign Keys:              <tabela>_id
Unique Constraints:        <tabela>_<coluna>_unique
Ãndices:                   idx_<tabela>_<colunas>
Triggers:                  trigger_<acao>
Functions:                 <acao>_<objeto>()
Views:                     vw_<nome_descritivo>
```

---

## ğŸ“Š Legenda

**SÃ­mbolos:**
- `PK` = Primary Key
- `FK` = Foreign Key
- `UQ` = Unique Constraint
- `â˜…` = Campo calculado automaticamente (trigger)
- `â†’` = Relacionamento 1:N
- `â—„â”€` = ObservaÃ§Ã£o/ComentÃ¡rio

**Tipos de Dados Especiais:**
- `JSONB` = JSON BinÃ¡rio (PostgreSQL)
- `ARRAY` = Array PostgreSQL (ex: TEXT[])
- `VECTOR` = pgvector extension (embeddings)
- `TIMESTAMP WITHOUT TIME ZONE` = Data/hora sem timezone

---

**VersÃ£o:** 2.0 (Com Sistema de SLA)
**Ãšltima AtualizaÃ§Ã£o:** 10/10/2025
**Total de Entidades:** 15 tabelas + 2 views
**AutomaÃ§Ã£o:** 8+ triggers
