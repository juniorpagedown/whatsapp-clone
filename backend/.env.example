# ============================================
# SERVIDOR
# ============================================
PORT=3001
NODE_ENV=development  # development | production | test

# ============================================
# BANCO DE DADOS (PostgreSQL)
# ============================================
DB_HOST=localhost
DB_PORT=5432
DB_NAME=whatsapp_clone
DB_USER=whatsapp_user
DB_PASSWORD=sua_senha_super_segura_aqui
DB_POOL_MAX=20
DB_POOL_IDLE_TIMEOUT=30000
DB_POOL_CONNECTION_TIMEOUT=2000

# ============================================
# REDIS (Cache + Filas)
# ============================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_URL=redis://localhost:6379
REDIS_DB=0

# ============================================
# EVOLUTION API (WhatsApp Gateway)
# ============================================
EVOLUTION_API_URL=https://sua-evolution-api.com
EVOLUTION_API_KEY=sua_chave_api_aqui
EVOLUTION_INSTANCE=sua_instancia
EVOLUTION_WEBHOOK_TOKEN=seu_token_secreto_webhook
EVOLUTION_WEBHOOK_ALLOW_NO_TOKEN=false

# ============================================
# OPENAI (IA Principal)
# ============================================
OPENAI_API_KEY=sk-proj-xxxxxxxxxxxxxxxxxx
OPENAI_MODEL_CHAT=gpt-4-turbo-preview
MODEL_CHAT=gpt-4o-mini
# Modelo para geração de embeddings (suporta OpenAI, Cohere, etc)
EMBEDDING_MODEL=text-embedding-3-small
MODEL_EMBEDDINGS=text-embedding-3-small
# OPENAI_MODEL_EMBEDDING=text-embedding-3-small  # DEPRECATED - use EMBEDDING_MODEL
OPENAI_MAX_TOKENS=500
OPENAI_TEMPERATURE=0.7

# ============================================
# OLLAMA (IA Local - Opcional)
# ============================================
OLLAMA_ENDPOINT=http://localhost:11434
OLLAMA_MODEL_CHAT=llama3.2
OLLAMA_MODEL_EMBEDDING=nomic-embed-text
EMBEDDING_PROVIDER=openai  # openai | local

# ============================================
# SEGURANÇA & AUTENTICAÇÃO
# ============================================
# Gere um JWT secret forte: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
JWT_SECRET=sua_chave_jwt_super_secreta_256bits_aqui_gere_uma_nova
JWT_EXPIRES_IN=7d
JWT_REFRESH_EXPIRES_IN=30d

# Bcrypt rounds (10-12 recomendado, maior = mais seguro mas mais lento)
BCRYPT_ROUNDS=12

# Controle de autocadastro (mantenha false em produção)
ALLOW_SELF_REGISTRATION=false

# CORS - Lista de origens permitidas (separadas por vírgula)
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173,https://seudominio.com

# ============================================
# RATE LIMITING
# ============================================
# Global rate limit
# Dev sugerido: 900000ms (15min) / 100 req
# Produção sugerido: 60000ms (1min) / 1000 req
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# Auth rate limit (mais restritivo)
RATE_LIMIT_AUTH_MAX=5  # Máximo de tentativas de login

# ============================================
# LOGS
# ============================================
LOG_LEVEL=info  # error | warn | info | http | debug
LOG_DIR=./logs
LOG_MAX_SIZE=5242880  # 5MB em bytes
LOG_MAX_FILES=5

# ============================================
# BACKUP & MANUTENÇÃO
# ============================================
BACKUP_DIR=/var/backups/whatsapp
BACKUP_RETENTION_DAYS=7
DIAS_MANTER_MENSAGENS=365  # Dias para manter mensagens antes de deletar

# ============================================
# FEATURES FLAGS
# ============================================
FEATURE_EMBEDDING=true
FEATURE_RAG=true
FEATURE_AUTO_REPLY=false
FEATURE_SENTIMENT_ANALYSIS=true
FEATURE_ANALYTICS=true
RAG_MAX_K=5

# Ajustes de classificação automática
CLASSIFICACAO_VECTOR_WEIGHT=0.5  # 0.0 prioriza keywords, 1.0 prioriza busca vetorial

# ============================================
# MONITORAMENTO (Opcional)
# ============================================
# Sentry para error tracking
SENTRY_DSN=

# APM (Application Performance Monitoring)
APM_ENABLED=false
APM_SERVICE_NAME=whatsapp-clone

# New Relic
NEW_RELIC_LICENSE_KEY=
NEW_RELIC_APP_NAME=whatsapp-clone

# DataDog
DD_API_KEY=
DD_SERVICE=whatsapp-clone

# ============================================
# FILAS (Bull)
# ============================================
QUEUE_EMBEDDING_CONCURRENCY=5
QUEUE_NOTIFICATION_CONCURRENCY=10
QUEUE_ANALYTICS_CONCURRENCY=3
QUEUE_CATALOG_CONCURRENCY=2
EMBEDDING_SCHEDULER_ENABLED=true
EMBEDDING_BACKFILL_CRON=0 * * * *
EMBEDDING_KB_CRON=30 2 * * *
EMBEDDING_CATALOG_CRON=0 3 * * *
EMBEDDING_BACKFILL_MAX_PER_RUN=500
EMBEDDING_JOB_ATTEMPTS=3
EMBEDDING_JOB_BACKOFF=10000
EMBEDDING_CATALOG_BATCH=50

# === CONFIGURAÇÕES AVANÇADAS DE EMBEDDINGS ===

# Número máximo de tentativas em caso de falha temporária (rate limit, 503, etc)
EMBEDDING_BACKFILL_MAX_RETRIES=3

# Tamanho do batch para processamento em lote (reduzir se houver rate limits)
EMBEDDING_BACKFILL_BATCH_SIZE=100

# Máximo de ciclos sem progresso antes de abortar (evita loops infinitos)
EMBEDDING_BACKFILL_MAX_EMPTY=3

EMBEDDING_BACKFILL_SLEEP_MS=1000    # Pausa entre ciclos de backfill em ms
EMBEDDING_MARK_EMPTY_AS_SKIPPED=true  # Marca mensagens sem conteúdo para não reprocessar

# ============================================
# CONTEXTO DE CONVERSAS (resumos + embeddings)
# ============================================
CONVERSA_CONTEXTO_SCHEDULER_ENABLED=true
CONVERSA_CONTEXTO_CRON=*/15 * * * *
CONTEXT_SUMMARY_WINDOW_SIZE=40
CONTEXT_SUMMARY_MIN_MESSAGES=5
CONTEXT_SUMMARY_CONVERSATION_LIMIT=5
CONTEXT_SUMMARY_MAX_TOKENS=450
# CONTEXT_SUMMARY_PROVIDER=openai

# ============================================
# FRONTEND (Opcional - usado no build)
# ============================================
VITE_API_URL=http://localhost:3001
VITE_WS_URL=ws://localhost:3001
VITE_APP_NAME=WhatsApp Clone IA
